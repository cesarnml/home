---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import { getCollection, render, type CollectionEntry } from 'astro:content';

const posts: CollectionEntry<'thoughts'>[] = (await getCollection('thoughts'))
  .sort((a: CollectionEntry<'thoughts'>, b: CollectionEntry<'thoughts'>) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Get the latest post content
const latestPost = posts[0];
const latestContent = latestPost ? await render(latestPost) : null;
---

<BaseLayout title="1036 days" description="Let's learn with AI">
  <div class="space-y-12">
    <Hero title="1036 days" subtitle="Let's learn with AI" />

    <!-- Latest Post Full Content -->
    {latestPost && latestContent && (
      <section class="bg-slate-800/50 backdrop-blur-sm rounded-2xl shadow-xl border border-slate-700/50 p-8 md:p-10">
        <div class="flex items-center gap-2 text-sm text-cyan-400 font-medium mb-4">
          <span class="inline-block w-2 h-2 bg-cyan-400 rounded-full animate-pulse"></span>
          Latest Thought
        </div>
        <a href={`/thoughts/${latestPost.id}`} class="group">
          <h2 class="text-3xl font-bold text-white group-hover:text-cyan-400 transition-colors mb-3">
            {latestPost.data.title}
          </h2>
        </a>
        <div class="flex items-center gap-4 text-sm text-slate-500 mb-6">
          <time datetime={latestPost.data.pubDate.toISOString()}>
            {latestPost.data.pubDate.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            })}
          </time>
          {latestPost.data.author && (
            <span class="flex items-center gap-1">
              <span class="text-slate-500">by</span> {latestPost.data.author}
            </span>
          )}
        </div>
        {latestPost.data.tags && (
          <div class="flex flex-wrap gap-2 mb-6">
            {latestPost.data.tags.map((tag: string) => (
              <span class="px-3 py-1 bg-violet-500/20 text-violet-300 rounded-full text-sm font-medium border border-violet-500/30">
                {tag}
              </span>
            ))}
          </div>
        )}
        <div class="prose prose-invert prose-lg max-w-none prose-headings:text-white prose-p:text-slate-300 prose-a:text-cyan-400 prose-a:no-underline hover:prose-a:underline prose-strong:text-white prose-pre:bg-slate-900 prose-pre:border prose-pre:border-slate-700 prose-code:text-fuchsia-400 prose-code:before:content-none prose-code:after:content-none prose-li:text-slate-300">
          <latestContent.Content />
        </div>
      </section>
    )}

    <!-- Previous Posts -->
    {posts.length > 1 && (
      <section>
        <h2 class="text-2xl font-bold text-white mb-6">Previous Thoughts</h2>
        <div class="grid gap-4">
          {posts.slice(1).map((post: CollectionEntry<'thoughts'>) => (
            <a href={`/thoughts/${post.id}`} class="group block bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50 hover:border-violet-500/50 hover:shadow-lg hover:shadow-violet-500/10 transition-all duration-300">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2">
                <h3 class="text-lg font-semibold text-white group-hover:text-cyan-400 transition-colors">
                  {post.data.title}
                </h3>
                <time datetime={post.data.pubDate.toISOString()} class="text-sm text-slate-500 shrink-0">
                  {post.data.pubDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                  })}
                </time>
              </div>
              <p class="text-slate-400 mt-2">{post.data.description}</p>
              {post.data.tags && (
                <div class="flex flex-wrap gap-2 mt-3">
                  {post.data.tags.map((tag: string) => (
                    <span class="px-2 py-0.5 bg-violet-500/20 text-violet-300 rounded-full text-xs border border-violet-500/30">
                      {tag}
                    </span>
                  ))}
                </div>
              )}
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- Empty State -->
    {posts.length === 0 && (
      <section class="text-center py-16">
        <div class="text-6xl mb-4">âœ¨</div>
        <h2 class="text-2xl font-bold text-white mb-2">No thoughts yet</h2>
        <p class="text-slate-400">Check back soon for new content.</p>
      </section>
    )}
  </div>
</BaseLayout>
